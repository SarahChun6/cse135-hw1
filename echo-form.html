<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Echo Form</title>
<script>
function getEndpoint(lang) {
    switch(lang) {
        case "php": return "/phpcode/echo-php.php";
        case "nodejs": return "/cgi-bin/nodejs/echo-nodejs.js";
        case "go": return "/cgi-bin/go/echo-go";
    }
    return "#";
}
function updateFormAction() {
    const lang = document.getElementById("language").value;
    document.getElementById("echoForm").action = getEndpoint(lang);
}
</script>
</head>
<body>
<h1>Echo Form</h1>

<form id="echoForm" method="POST" onsubmit="updateFormAction()">
    <!-- Language selection -->
    <label for="language">Language:</label>
    <select id="language" name="language" onchange="updateFormAction()">
        <option value="php">PHP</option>
        <option value="nodejs">NodeJS</option>
        <option value="go">Go</option>
    </select>
    <br><br>

    <!-- HTTP method -->
    <label for="method">HTTP Method:</label>
    <select id="method" name="_method">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
    </select>
    <br><br>

    <!-- Encoding -->
    <label for="encoding">Encoding:</label>
    <select id="encoding" name="_encoding">
        <option value="application/x-www-form-urlencoded">x-www-form-urlencoded</option>
        <option value="application/json">application/json</option>
    </select>
    <br><br>

    <!-- Data fields -->
    <label for="field1">Field 1:</label>
    <input type="text" id="field1" name="field1">
    <br><br>

    <label for="field2">Field 2:</label>
    <input type="text" id="field2" name="field2">
    <br><br>

    <button type="submit">Submit</button>
</form>

<h2>Response:</h2>
<pre id="responseOutput">No response yet.</pre>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('echoForm');
  const output = document.getElementById('responseOutput');

  form.addEventListener('submit', (e) => {
    e.preventDefault(); // prevent default submit

    const endpoint = getEndpoint(document.getElementById('language').value);
    const method = document.getElementById('method').value;
    const encoding = document.getElementById('encoding').value;

    let headers = {};
    let body = null;

    if (method === 'GET' || method === 'DELETE') {
      // append fields as query string for GET/DELETE
      const params = new URLSearchParams({
        field1: form.field1.value,
        field2: form.field2.value,
        _method: method,
        _encoding: encoding,
        language: lang
      });
      fetch(endpoint + '?' + params.toString(), { method })
        .then(res => res.text())
        .then(text => output.textContent = text)
        .catch(err => output.textContent = err);
    } else {
      // POST or PUT
      if (encoding === 'application/json') {
        headers['Content-Type'] = 'application/json';
        body = JSON.stringify({
          field1: form.field1.value,
          field2: form.field2.value,
          _method: method,
          _encoding: encoding,
          language: lang 
        });
      } else {
        headers['Content-Type'] = 'application/x-www-form-urlencoded';
        body = new URLSearchParams({
          field1: form.field1.value,
          field2: form.field2.value,
          _method: method,
          _encoding: encoding,
          language: lang
        });
      }

      fetch(endpoint, { method, headers, body })
        .then(res => res.text())
        .then(text => output.textContent = text)
        .catch(err => output.textContent = err);
    }
  });
});
</script>

</body>
</html>

<!-- Optional: fallback for no JS -->
<noscript>
<p>JavaScript is off. The form will submit via POST to the selected language endpoint.</p>
</noscript>