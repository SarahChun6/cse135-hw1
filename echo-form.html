<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Echo Form</title>
</head>
<body>
<h1>Echo Form</h1>

<form id="echoForm"> <!-- method="POST" onsubmit="updateFormAction()"-->
    <!-- Language selection -->
    <label for="language">Language:</label>
    <select id="language" name="language"> <!-- onchange="updateFormAction()">
        <option value="php">PHP</option>
        <option value="nodejs">NodeJS</option>
        <option value="go">Go</option>
    </select>
    <br><br>

    <!-- HTTP method -->
    <label for="method">HTTP Method:</label>
    <select id="method" name="_method">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
    </select>
    <br><br>

    <!-- Encoding -->
    <label for="encoding">Encoding:</label>
    <select id="encoding" name="_encoding">
        <option value="application/x-www-form-urlencoded">x-www-form-urlencoded</option>
        <option value="application/json">application/json</option>
    </select>
    <br><br>

    <!-- Data fields -->
    <label for="field1">Field 1:</label>
    <input type="text" id="field1" name="field1">
    <br><br>

    <label for="field2">Field 2:</label>
    <input type="text" id="field2" name="field2">
    <br><br>

    <button type="submit">Submit</button>
</form>

<h2>Response:</h2>
<pre id="responseOutput">No response yet.</pre>

<script>
    const form = document.getElementById('echoForm');
    const output = document.getElementById('responseOutput');

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        const language = document.getElementById('language').value;
        const method = document.getElementById('method').value;
        const encoding = document.getElementById('encoding').value;
        const field1 = document.getElementById('field1').value;
        const field2 = document.getElementById('field2').value;

        // Determine endpoint based on language
        let endpoint = '';
        if (language === 'php') endpoint = '/phpcode/echo-php.php';
        else if (language === 'nodejs') endpoint = '/cgi-bin/nodejs/echo-nodejs.js';
        else if (language === 'go') endpoint = '/cgi-bin/go/echo-go';

        // Prepare headers & body
        let headers = {};
        let body = null;

        if (method === 'GET' || method === 'DELETE') {
            // Add fields to query string
            const params = new URLSearchParams({ 
                field1: form.field1.value,
                field2: form.field2.value,
                _method: method,
                _encoding: encoding });
                fetch(endpoint + '?' + params.toString(), { method })
                    .then(r => r.text())
                    .then(txt => output.textContent = txt)
                    .catch(err => output.textContent = err);
        } else {
            // POST or PUT
            if (encoding === 'application/json') {
                headers['Content-Type'] = 'application/json';
                body = JSON.stringify({ 
                    field1: form.field1.value, 
                    field2: form.field2.value,
                    _method: method,
                    _encoding: encoding 
                });
            } else {
                headers['Content-Type'] = 'application/x-www-form-urlencoded';
                body = new URLSearchParams({ 
                    field1: form.field1.value, 
                    field2: form.field2.value, 
                    _method: method, 
                    _encoding: encoding 
                });
            }

            fetch(endpoint, { method, headers, body })
                .then(r => r.text())
                .then(txt => output.textContent = txt)
                .catch(err => output.textContent = err);
        }
    });
</script>

</body>
</html>

<!-- Optional: fallback for no JS -->
<noscript>
<p>JavaScript is off. Form functionality may be limited.</p>
</noscript>